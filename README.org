#+TITLE: NixOS configuration

** Installation
Get the latest NixOS image [[https://nixos.org/download.html][here]], do your partitions (root must be mounted at =/mnt=), then run the following commands
#+begin_src sh
  nix-shell -p git nixFlakes
  git clone https://github.com/fortuneteller2k/nix-config /etc/nixos
  sudo nixos-install --flake
#+end_src

*** Caveats
 * You probably should replace [[https://github.com/fortuneteller2k/nix-config/blob/master/nixos/hardware-configuration.nix][nixos/hardware-configuration.nix]] with your own with =nixos-generate-config=.
 * Remove this [[https://github.com/fortuneteller2k/nix-config/blob/master/nixos/configuration.nix#L55][line]] when not running with AMD graphics.
 * You might want to change =users.users.fortuneteller2k= to =users.users.yourname= in this [[https://github.com/fortuneteller2k/nix-config/blob/master/nixos/configuration.nix#L140][part]] of =configuration.nix=, =username= and =homeDirectory= to your username in this [[https://github.com/fortuneteller2k/nix-config/blob/master/home/fortuneteller2k.nix#L159][part]] of =fortuneteller2k.nix=, and rename [[https://github.com/fortuneteller2k/nix-config/blob/master/home/fortuneteller2k.nix][fortuneteller2k.nix]] to your username and change the import [[https://github.com/fortuneteller2k/nix-config/blob/master/flake.nix#L47][here]] accordingly.
 * Change =amd= in =hardware.cpu.amd.updateMicrocode= to =intel= when running with an Intel CPU. 

** Description
NixOS configuration that I use daily, it contains the system-wide *AND* home configuration, symlinked to =/etc/nixos=

See also:
 * [[https://github.com/nix-community/home-manager][home-manager]]
 * [[https://nixos.wiki/wiki/Flakes][flakes]]

Resources and configurations I used to base on:
 * [[https://github.com/hlissner/dotfiles][hlissner/dotfiles]]
 * [[https://github.com/colemickens/nixos-flake-example][colemickens/nixos-flake-example]]
 * [[https://github.com/nrdxp/nixflk][nrdxp/nixflk]]
 * [[https://git.sr.ht/~dunklecat/nixos-config/tree/master/flake.nix][dunklecat/nixos-config]]
 * [[https://www.youtube.com/watch?v=UeBX7Ide5a0][Nix Flakes talk by Eelco Dolstra on NixCon]]

*** Useful Commands
| command                                 | description                             |
|-----------------------------------------+-----------------------------------------|
| =sudo nixos-rebuild switch=             | update and switch to the new generation |
| =nix flake update --update-input flake= | update flake and update lockfile        |
| =nix flake update --recreate-lock-file= | update all flakes and update lockfile   |
